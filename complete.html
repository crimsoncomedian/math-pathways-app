<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Assessment Complete</title>
  <link rel="stylesheet" href="css/style.css" />
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background-color: #f9fafb;
      font-family: system-ui, sans-serif;
      margin: 0;
    }
    .card {
      background: white;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.08);
      text-align: center;
      max-width: 450px;
      width: 90%;
    }
    h1 {
      margin-top: 0;
      font-size: 1.75rem;
      color: #111827;
    }
    p {
      color: #374151;
      font-size: 1.05rem;
      margin: 0.75rem 0 1.5rem;
    }
    .actions {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-top: 1.5rem;
    }
    .btn {
      background-color: #2563eb;
      color: white;
      padding: 0.6rem 1.25rem;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    .btn:hover {
      background-color: #1d4ed8;
    }
    .btn.secondary {
      background-color: #e5e7eb;
      color: #111827;
    }
    .btn.secondary:hover {
      background-color: #d1d5db;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>You're All Done! ðŸŽ‰</h1>
    <p>Thanks for completing the assessment.</p>
    <p>Your responses have been recorded.</p>
    <div class="actions">
      <button id="restartBtn" class="btn secondary">Start Over</button>
      <button id="exitBtn" class="btn">Exit</button>
    </div>
  </div>

  <script type="module">
  import { getKV } from './js/app.js';

  const firstName = getKV('firstName','');
  const lastName  = getKV('lastName','');
  const struggleReasons = getKV('struggle_reasons', []);

  function packModule(n){
    const p = `m${n}`;
    const q1 = getKV(`${p}_q1`, null); // expect {id,text,answer,timeSpent,...}
    const q2 = getKV(`${p}_q2`, null);
    return {
      rank:       getKV(`${p}_ranking`, []),
      confidence: getKV(`${p}_confidence`, {}),
      q1: q1 ? { id: q1.id, answer: q1.answer ?? "", timeSpent: q1.timeSpent } : null,
      q2: q2 ? { id: q2.id, answer: q2.answer ?? "", timeSpent: q2.timeSpent } : null,
      reflection: getKV(`${p}_reflection`, null)
    };
  }

  const payload = {
    firstName, lastName, struggleReasons,
    m1: packModule(1),
    m2: packModule(2),
    m3: packModule(3),
    m4: packModule(4)
  };

  fetch("https://script.google.com/macros/s/AKfycbw5jZzgcB9BmRjxvwU3Wbrwr1VFUy5hdGKfBzIpiLX98xdehdIiqj4j2_sdBScV5GBf/exec", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  })
  .then(r => r.json())
  .then(console.log)
  .catch(console.error);
</script>

</body>
</html>
