<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Polynomials – Ranking</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <!-- visual-only progress (adjust as you like) -->
  <div class="progress"><i style="width:72%"></i></div>

  <main class="container" role="main">
    <h2>Polynomials — Rank the Questions</h2>
    <p class="sub">Drag the questions so the <b>easiest is on top</b> and the <b>hardest on the bottom</b>.</p>

    <ul id="rankList" class="sortable" aria-label="Rank questions from easiest to hardest"></ul>

    <div class="actions" style="justify-content:space-between">
      <button class="btn" type="button" onclick="window.location.href='m3_reflection.html'">Back</button>
      <button id="continueBtn" class="btn" type="button">Continue</button>
    </div>
  </main>

  <script type="module">
    import { setKV, getKV, setProgress } from './js/app.js';
    setProgress(72);

    // Module 4 — Polynomials (IDs matter for later logic)
    const QUESTIONS = [
      { id:'poly1', text:'Identify the degree of the polynomial: 4x^3 + 2x^2 − 7x + 6.' },
      { id:'poly2', text:'Multiply (x + 2)(x − 5).' },
      { id:'poly3', text:'How would changing the value of 3 to a negative number in f(x) = 3x^2 + 5x + 1 affect the graph?' },
      { id:'poly4', text:'Factor 6x^2 + 11x + 3.' },
      { id:'poly5', text:'Name any factor of the polynomial x^3 + x^2 − 14x − 24.' }
    ];

    const listEl = document.getElementById('rankList');

    // Use saved order if returning
    const savedOrder = getKV('m4_ranking', null);
    const order = (savedOrder && Array.isArray(savedOrder) && savedOrder.length === QUESTIONS.length)
      ? savedOrder
      : QUESTIONS.map(q => q.id);

    const byId = id => QUESTIONS.find(q => q.id === id);

    function render(){
      listEl.innerHTML = '';
      order.forEach((id, idx) => {
        const li = document.createElement('li');
        li.className = 'draggable';
        li.draggable = true;
        li.dataset.id = id;
        li.innerHTML = `
          <span class="badge">${idx+1}</span>
          <span class="qtext">${byId(id).text}</span>
          <span class="handle" aria-hidden="true">⋮⋮</span>
        `;
        listEl.appendChild(li);
      });
    }
    render();

    // Drag & drop behavior
    listEl.addEventListener('dragstart', (e)=>{
      const li = e.target.closest('li.draggable');
      if(!li) return;
      li.classList.add('dragging');
      e.dataTransfer.effectAllowed = 'move';
    });
    listEl.addEventListener('dragend', (e)=>{
      const li = e.target.closest('li.draggable');
      if(li) li.classList.remove('dragging');
      [...listEl.children].forEach((li,i)=> li.querySelector('.badge').textContent = i+1);
    });
    listEl.addEventListener('dragover', (e)=>{
      e.preventDefault();
      const after = getDragAfterElement(listEl, e.clientY);
      const dragging = listEl.querySelector('.dragging');
      if(!dragging) return;
      if(after == null) listEl.appendChild(dragging);
      else listEl.insertBefore(dragging, after);
    });

    function getDragAfterElement(container, y){
      const els = [...container.querySelectorAll('li.draggable:not(.dragging)')];
      return els.reduce((closest, child) => {
        const box = child.getBoundingClientRect();
        const offset = y - box.top - box.height / 2;
        if(offset < 0 && offset > closest.offset){
          return { offset, element: child };
        } else {
          return closest;
        }
      }, { offset: Number.NEGATIVE_INFINITY }).element;
    }

    // Save & continue
    document.getElementById('continueBtn').addEventListener('click', ()=>{
      const ids = [...listEl.querySelectorAll('li')].map(li => li.dataset.id);
      setKV('m4_ranking', ids);      // easiest → hardest
      setKV('m4_questions', QUESTIONS);
      window.location.href = 'm4_confidence.html';
    });
  </script>
</body>
</html>
