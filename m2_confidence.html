<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Equations & Inequalities ‚Äì Confidence</title>
  <link rel="stylesheet" href="css/style.css" />
  <style>
    .confidence-key {
      background: #f7f8fc;
      padding: 10px 15px;
      border-radius: 8px;
      margin-bottom: 18px;
      display: flex;
      gap: 16px;
      font-size: 14px;
      justify-content: center;
      align-items: center;
      border: 1px solid #e0e0e0;
    }

    .confidence-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      margin-bottom: 10px;
      background: #fff;
    }

    .question-text {
      flex: 1;
      margin-right: 12px;
      font-size: 15px;
    }

    .emoji-buttons {
      display: flex;
      gap: 12px;
      flex-shrink: 0;
    }

    .emoji-btn {
      font-size: 20px;
      background: none;
      border: none;
      cursor: pointer;
      transition: transform 0.15s ease;
    }

    .emoji-btn.selected {
      transform: scale(1.3);
    }

    .actions {
      margin-top: 20px;
      display: flex;
      justify-content: space-between;
    }
  </style>
</head>
<body>
  <div class="progress"><i style="width:80%"></i></div>

  <main class="container" role="main">
    <h2>How confident do you feel about each problem?</h2>
    <p>Choose one confidence level for each question.</p>

    <!-- Key at the top -->
    <div class="confidence-key">
      <span>üòü Not confident</span>
      <span>üòê Somewhat</span>
      <span>üòé Very confident</span>
    </div>

    <!-- Questions + emoji buttons -->
    <div id="confidenceList"></div>

    <div class="actions">
      <button class="btn" onclick="window.location.href='m2_ranking.html'">Back</button>
      <button id="continueBtn" class="btn" disabled>Continue</button>
    </div>
  </main>

  <script type="module">
    import { getKV, setKV, setProgress } from './js/app.js';
    setProgress(80);

    const QUESTIONS = getKV('m2_questions', []);
    const saved = getKV('m2_confidence', {});
    const container = document.getElementById('confidenceList');
    const continueBtn = document.getElementById('continueBtn');

    // Confidence mapping
    const EMOJIS = [
      { key: 'low', icon: 'üòü' },
      { key: 'med', icon: 'üòê' },
      { key: 'high', icon: 'üòé' }
    ];

    // Render questions dynamically
    function render() {
      container.innerHTML = '';
      QUESTIONS.forEach(q => {
        const row = document.createElement('div');
        row.className = 'confidence-row';
        row.innerHTML = `
          <div class="question-text">${q.text}</div>
          <div class="emoji-buttons">
            ${EMOJIS.map(e => `
              <button class="emoji-btn ${saved[q.id] === e.key ? 'selected' : ''}" 
                      data-id="${q.id}" 
                      data-value="${e.key}">
                ${e.icon}
              </button>
            `).join('')}
          </div>
        `;
        container.appendChild(row);
      });

      // Add click handlers to emoji buttons
      document.querySelectorAll('.emoji-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.dataset.id;
          const val = btn.dataset.value;
          saved[id] = val;
          setKV('m2_confidence', saved);
          render(); // re-render to show selection visually
          checkAllAnswered();
        });
      });
    }

    // Enable continue only if all questions are answered
    function checkAllAnswered() {
      const allAnswered = QUESTIONS.every(q => saved[q.id]);
      continueBtn.disabled = !allAnswered;
    }

    // Continue ‚Üí go to first adaptive question
    continueBtn.addEventListener('click', () => {
      setKV('m2_confidence', saved);
      window.location.href = 'm2_q1.html';
    });

    render();
    checkAllAnswered();
  </script>
</body>
</html>
