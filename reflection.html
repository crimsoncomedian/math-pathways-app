<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Math Pathways – Reflection</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <!-- Progress Bar -->
  <div class="progress"><i style="width:18%"></i></div>

  <main class="container" role="main">
    <h2>Thinking About Math</h2>
    <p class="sub">Which of the following best describe why you sometimes get wrong answers?  
    Select all that apply.</p>

    <form id="reflectionForm">
      <div class="checkbox-group">
        <label class="checkbox">
          <input type="checkbox" name="reason" value="Difficulty understanding the question">
          Difficulty understanding the question
        </label>
        <label class="checkbox">
          <input type="checkbox" name="reason" value="Difficulty understanding the math">
          Difficulty understanding the math
        </label>
        <label class="checkbox">
          <input type="checkbox" name="reason" value="Making silly math mistakes">
          Making silly math mistakes
        </label>
        <label class="checkbox">
          <input type="checkbox" name="reason" value="Feeling anxiety about math">
          Feeling anxiety about math
        </label>
        <label class="checkbox">
          <input type="checkbox" name="reason" value="Overthinking the problem">
          Overthinking the problem
        </label>
        <label class="checkbox">
          <input type="checkbox" name="reason" value="Being careless or rushing">
          Being careless or rushing
        </label>
        <label class="checkbox">
          <input type="checkbox" name="reason" value="I don’t typically struggle with math">
          I don’t typically struggle with math
        </label>
      </div>

      <div class="actions">
        <button type="submit" class="btn" id="continueBtn" disabled>Continue</button>
      </div>
    </form>
  </main>

  <script type="module">
  // Optional helpers with safe fallbacks
  let setKV = () => {};
  let setProgress = () => {};
  try {
    const mod = await import('./js/app.js');         // will succeed only if present/valid
    if (typeof mod.setKV === 'function') setKV = mod.setKV;
    if (typeof mod.setProgress === 'function') setProgress = mod.setProgress;
  } catch (e) {
    console.warn('app.js not found or no exports; continuing without it.', e);
  }

  // Visual progress (no-op if helper missing)
  try { setProgress(18); } catch {}

  const form = document.getElementById('reflectionForm');
  const btn  = document.getElementById('continueBtn');

  // Enable Continue when at least one option is checked
  function updateState() {
    const selected = form.querySelectorAll('input[type="checkbox"]:checked');
    btn.disabled = selected.length === 0;
  }
  form.addEventListener('change', updateState);
  updateState(); // in case of autofill / pre-checked

  // Save + navigate (navigate even if save fails)
  form.addEventListener('submit', (e) => {
    e.preventDefault();
    const selected = [...form.querySelectorAll('input[type="checkbox"]:checked')].map(cb => cb.value);

    try { setKV('struggle_reasons', selected); } catch (err) { console.warn(err); }

    // Important: make sure this file exists at the same folder level as reflection.html
    window.location.assign('m1_ranking.html');
  });
</script>

</body>
</html>
